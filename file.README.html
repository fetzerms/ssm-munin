<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.25
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-Puppet+module+ssm-munin">Puppet module ssm-munin</h1>

<p><a href="https://forge.puppetlabs.com/ssm/munin"><img
src="https://img.shields.io/puppetforge/v/ssm/munin.svg"></a> <a
href="https://travis-ci.org/ssm/ssm-munin"><img
src="https://travis-ci.org/ssm/ssm-munin.png?branch=master"></a></p>
<!-- markdown-toc start - Don't edit this section. Run M-x markdown-toc-generate-toc again -->
<p><strong>Table of Contents</strong></p>
<ul><li>
<p><a href="#label-Puppet+module+ssm+munin">Puppet module ssm-munin</a></p>
</li><li>
<p><a href="#label-Overview">Overview</a></p>
</li><li>
<p><a href="#label-Module+description">Module Description</a></p>
</li><li>
<p><a href="#label-Setup">Setup</a></p>
<ul><li>
<p><a href="#label-Setup+requirements">Setup requirements</a></p>
</li></ul>
</li><li>
<p><a href="#label-Usage">Usage</a></p>
<ul><li>
<p><a href="#label-Muninnode">munin::node</a></p>
</li><li>
<p><a href="#label-Muninmaster">munin::master</a></p>
</li><li>
<p><a href="#label-Muninmasternodedefinition">munin::master::node_definition</a></p>
</li><li>
<p><a href="#label-Muninplugin">munin::plugin</a></p>
</li></ul>
</li><li>
<p><a href="#label-Examples">Examples</a></p>
<ul><li>
<p><a href="#label-Muninmasternodedefinition">munin::master::node_definition</a></p>
<ul><li>
<p><a href="#label-Static+node+definitions">Static node definitions</a></p>
</li><li>
<p><a href="#label-Node+definitions+as+class+parameter">node definitions as class
parameter</a></p>
</li><li>
<p><a href="#label-Node+definitions+with+hiera">node definitions with hiera</a></p>
</li></ul>
</li><li>
<p><a href="#label-Muninnode">munin::node</a></p>
<ul><li>
<p><a href="#label-Allow+remote+masters+to+connect">Allow remote masters to
connect</a></p>
</li></ul>
</li><li>
<p><a href="#label-Muninplugin">munin::plugin</a></p>
<ul><li>
<p><a href="#label-Activate+a+plugin">Activate a plugin</a></p>
</li><li>
<p><a href="#label-Install+and+activate+a+plugin">Install and activate a plugin</a></p>
</li><li>
<p><a href="#label-Activate+wildcard+plugin">Activate wildcard plugin</a></p>
</li><li>
<p><a href="#label-Plugin+with+configuration">Plugin with configuration</a></p>
</li><li>
<p><a href="#label-A+plugin+configuration+file">A plugin configuration file</a></p>
</li></ul>
</li></ul>
</li></ul>
<!-- markdown-toc end -->
<h1 id="label-Overview">Overview</h1>

<p>Configure munin master, node and plugins.</p>

<h1 id="label-Module+Description">Module Description</h1>

<p>This module installs the munin master using the
<strong>munin::master</strong> class, munin node using the
<strong>munin::node</strong> class, and can install, configure and manage
munin plugins using the <strong>munin::plugin</strong> defined type.</p>

<p>Munin nodes are automatically exported by the munin nodes, and collected on
the munin master. (Requires puppetdb)</p>

<h1 id="label-Setup">Setup</h1>

<p>Classify all nodes with <strong>munin::node</strong>, and classify at least
one node with <strong>munin::master</strong>. Use the
<strong>munin::plugin</strong> defined type to control plugin installation
and configuration.</p>

<h2 id="label-Setup+requirements">Setup requirements</h2>

<p>Munin should be available in most distributions. For RedHat OS Family, you
need to install the EPEL source.</p>

<p>The <strong>munin::master</strong> class does not manage any web server
configuration. The munin package installed might add some.</p>

<h1 id="label-Usage">Usage</h1>

<p>For detailed usage, see the reference.</p>

<h2 id="label-munin-3A-3Anode">munin::node</h2>

<p>Typical usage</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_munin'>munin</span><span class='op'>::</span><span class='id identifier rubyid_node'>node</span>
</code></pre>

<p>Installs a munin node.</p>

<p>By default, <strong>munin::node</strong> exports a munin node definition so
a node classified with the <strong>munin::master</strong> class can collect
it.</p>

<h3 id="label-Export+extra+nodes">Export extra nodes</h3>

<p>If <strong>munin::node::export_node</strong> is enabled, you may export
additional nodes with the
<strong>munin::node::export::node_definitions</strong> hash. These are
exported as <strong>munin::master::node_definition</strong> resources. They
will be associated with the same mastername as the node itself.</p>

<h2 id="label-munin-3A-3Amaster">munin::master</h2>

<p>Typical usage:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_munin'>munin</span><span class='op'>::</span><span class='id identifier rubyid_master'>master</span>
</code></pre>

<p>Installs a munin master.</p>

<p>By default, <strong>munin::master</strong> collects all munin node
definitions exported by nodes classified with <strong>munin::node</strong>.</p>

<h2 id="label-munin-3A-3Amaster-3A-3Anode_definition">munin::master::node_definition</h2>

<p>This will add configuration for the munin master to connect to a munin
node, and ask for data from its munin plugins.</p>

<p>Note: By default, the node classified with <strong>munin::master</strong>
will collect all all exported instances of this type from hosts classified
with <strong>munin::node</strong>.</p>

<p>The resource title is used as the munin FQN, or “fully qualified name”.
This defines the node name and group. It is common to use the host&#39;s
fully qualified domain name, where the domain name will be implicitly used
as the node group.</p>

<p>For more information about configuring a munin node definition, see <a
href="https://munin.readthedocs.io/en/latest/reference/munin.conf.html#node-definitions">munin.readthedocs.io/en/latest/reference/munin.conf.html#node-definitions</a></p>

<p>If you have multiple munin master servers in your infrastructure and want
to assign different nodes to different masters, you can specify the
master&#39;s fully qualified domain name on the node&#39;s definition:</p>

<pre class="code ruby"><code class="ruby">munin::master::node_definition { &#39;fqn&#39;:
    address    =&gt; $address,
    mastername =&gt; &#39;munin.example.com&#39;,
}
</code></pre>

<h1 id="label-Examples">Examples</h1>

<h2 id="label-munin-3A-3Amaster-3A-3Anode_definition">munin::master::node_definition</h2>

<h3 id="label-Static+node+definitions">Static node definitions</h3>

<p>The munin master class will collect all “munin::master::node_definition”
exported by “munin::node”.</p>

<p>For extra nodes, you can define them in hiera data for the master server,
and munin::master will create them. Example:</p>

<pre class="code ruby"><code class="ruby">munin::master::node_definition { &#39;foo.example.com&#39;:
  address =&gt; &#39;192.0.2.1&#39;
}
munin::master::node_definition { &#39;bar.example.com&#39;:
  address =&gt; &#39;192.0.2.1&#39;,
  config  =&gt; [ &#39;load.graph_future 30&#39;,
               &#39;load.load.trend yes&#39;,
               &#39;load.load.predict 86400,12&#39; ],
}
</code></pre>

<p>See also <strong>munin::node::export::node_definitions</strong> for extra
nodes declared on the clients.</p>

<h3 id="label-node+definitions+as+class+parameter">node definitions as class parameter</h3>

<p>If you define your nodes as a data structure in a puppet manifest, or from
the puppet External Node Classifier, you can use a class parameter:</p>

<pre class="code ruby"><code class="ruby">$nodes = { ... }

class { &#39;puppet::master&#39;:
  node_definitions =&gt; $nodes,
}
</code></pre>

<h3 id="label-node+definitions+with+hiera">node definitions with hiera</h3>

<p>A JSON definition.</p>

<pre class="code ruby"><code class="ruby">{
  &quot;munin::master::node_definitions&quot; : {
    &quot;foo.example.com&quot; : {
      &quot;address&quot; : &quot;192.0.2.1&quot;
    },
    &quot;bar.example.com&quot; : {
      &quot;address&quot; : &quot;192.0.2.2&quot;,
      &quot;config&quot; : [
        &quot;load.graph_future 30&quot;,
        &quot;load.load.trend yes&quot;,
        &quot;load.load.predict 86400,12&quot;
      ]
    }
  }
}
</code></pre>

<p>A YAML definition</p>

<pre class="code ruby"><code class="ruby">---
munin::master::node_definitions:
  foo.example.com:
    address: 192.0.2.1
  bar.example.com:
    address: 192.0.2.2
    config:
    - load.graph_future 30
    - load.load.trend yes
    - load.load.predict 86400,12
</code></pre>

<h2 id="label-munin-3A-3Anode">munin::node</h2>

<h3 id="label-Allow+remote+masters+to+connect">Allow remote masters to connect</h3>

<p>The <strong>allow</strong> parameter enables the munin master to connect.
By default, the munin node only permits connections from localhost.</p>

<pre class="code ruby"><code class="ruby">class { &#39;munin::node&#39;:
    allow =&gt; [ &#39;192.0.2.0/24&#39;, &#39;2001:db8::/64&#39; ]
}
</code></pre>

<p>or in hiera:</p>

<pre class="code ruby"><code class="ruby">---
munin::node::allow:
  - 192.0.2.0/24
  - 2001:db8::/64
</code></pre>

<p>Installs munin-node, and exports a munin::master::node_definition which
munin::master will collect, and allows munin masters on specified networks
to connect.</p>

<h2 id="label-munin-3A-3Aplugin">munin::plugin</h2>

<h3 id="label-Activate+a+plugin">Activate a plugin</h3>

<p>Here, we activate an already installed plugin.</p>

<p>The use of “ensure =&gt; link” creates an implicit “target =&gt;
/usr/share/munin/plugins/$title”.</p>

<p>The “target” parameter can be set to an absolute path (starting with a
“/”), or a relative path (anything else). If relative,
$munin::params::node::plugin_share_dir is prepended to the path.</p>

<pre class="code ruby"><code class="ruby">munin::plugin {
  &#39;apt&#39;:
    ensure =&gt; link;
  &#39;something&#39;:
    ensure =&gt; link,
    target =&gt; &#39;/usr/local/share/munin/plugins/something&#39;;
  &#39;ip_eth0&#39;:
    ensure =&gt; link,
    target =&gt; &#39;ip_&#39;; # becomes $munin::params::node::plugin_share_dir/ip_
}
</code></pre>

<h3 id="label-Install+and+activate+a+plugin">Install and activate a plugin</h3>

<p>The use of “ensure =&gt; present” creates a file in /etc/munin/plugins</p>

<pre class="code ruby"><code class="ruby">munin::plugin { &#39;somedaemon&#39;:
    ensure =&gt; present,
    source =&gt; &#39;puppet:///modules/munin/plugins/somedaemon&#39;,
}
</code></pre>

<h3 id="label-Activate+wildcard+plugin">Activate wildcard plugin</h3>

<p>A pair of plugins we provide, with a _name symlink (This is also known as
“wildcard” plugins)</p>

<pre class="code ruby"><code class="ruby">munin::plugin {
  &#39;foo_bar&#39;:
    ensure =&gt; present,
    target =&gt; &#39;foo_&#39;,
    source =&gt; &#39;puppet:///modules/munin/plugins/foo_&#39;;
  &#39;foo_baz&#39;:
    ensure =&gt; present,
    target =&gt; &#39;foo_&#39;,
    source =&gt; &#39;puppet:///modules/munin/plugins/foo_&#39;;
}
</code></pre>

<h3 id="label-Plugin+with+configuration">Plugin with configuration</h3>

<p>This creates an additional “/etc/munin/plugin-conf.d/$title.conf”</p>

<pre class="code ruby"><code class="ruby">munin::plugin {
  &#39;bletch&#39;:
    ensure =&gt; link,
    config =&gt; &#39;env.database flumpelump&#39;;
  &#39;thud&#39;:
    ensure =&gt; present,
    source =&gt; &#39;puppet:///modules/munin/plugins/thud&#39;,
    config =&gt; [&#39;env.database zotto&#39;, &#39;user root&#39;];
}
</code></pre>

<h3 id="label-A+plugin+configuration+file">A plugin configuration file</h3>

<p>This only adds a plugin configuration file.</p>

<pre class="code ruby"><code class="ruby">munin::plugin { &#39;slapd&#39;:
  config       =&gt; [&#39;env.rootdn cn=admin,dc=example,dc=org&#39;],
  config_label =&gt; &#39;slapd_*&#39;,
}
</code></pre>
</div></div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>